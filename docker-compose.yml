version: '2'
services:
  builder:
    build: .
    image: summon-aws-secrets-builder
    entrypoint: /usr/local/go/bin/go
    command: build -v
    volumes:
      - ./output:/summon-aws-secrets/output
    environment:
      GOOS:
      GOARCH:

  tester:
    build: .
    image: summon-aws-secrets-tester
    ports:
      - "8080"
    command: './test-entrypoint.sh'
    volumes:
      - .:/summon-aws-secrets

  localstack:
    image: localstack/localstack
    environment:
      - SERVICES=secretsmanager
      - HOSTNAME=localstack
      - DEFAULT_REGION=us-east-1
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_TEST_ENDPOINT
      - AWS_DEFAULT_REGION
